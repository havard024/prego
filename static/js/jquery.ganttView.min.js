(function(a){function u(q){function b(){var b=s.getBoundaryDatesFromData(f.data,Math.floor(f.slideWidth/f.cellWidth+5));f.start=b[0];f.end=b[1];k.each(function(){var e=a(this),c=a("<div>",{"class":"ganttview"});(new v(c,f)).render();e.append(c);c=a("div.ganttview-vtheader",e).outerWidth()+a("div.ganttview-slide-container",e).outerWidth();e.css("width",c+2+"px");(new w(e,f)).apply()})}var k=this,f=a.extend(!0,{showWeekends:!0,cellWidth:21,cellHeight:31,slideWidth:400,vHeaderWidth:100,behavior:{clickable:!0, draggable:!0,resizable:!0}},q);f.data?b():f.dataUrl&&a.getJSON(f.dataUrl,function(a){f.data=a;b()})}function x(a,b){if(a=="setSlideWidth"){var k=$("div.ganttview",this);$("div#ganttChart",this);k.each(function(){var a=$("div.ganttview-vtheader",k).outerWidth();$(k).width(b+1);$("div.ganttview-slide-container",this).width(b-a);u()})}$("#ganttChart").width(b)}a.fn.ganttView=function(){var a=Array.prototype.slice.call(arguments);a.length==1&&typeof a[0]=="object"&&u.call(this,a[0]);a.length==2&&typeof a[0]== "string"&&x.call(this,a[0],a[1])};$(window).resize(function(){$("#ganttChart").ganttView("setSlideWidth",$("div.module-block").width()-$("td.module-sidebar").width()-60)});var v=function(q,b){function k(b,e,c){e={id:e.id,name:e.name};a.extend(e,c);b.data("block-data",e)}var f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{render:function(){for(var g=b.data,e=b.cellHeight,c=a("<div>",{"class":"ganttview-vtheader"}),d=0;d<g.length;d++){var i=a("<div>",{"class":"ganttview-vtheader-item"}); i.append(a("<div>",{"class":"ganttview-vtheader-item-name",css:{height:g[d].series.length*e+"px"}}).append(g[d].name));var r=a("<div>",{"class":"ganttview-vtheader-series"}),p=g[d].start,t=g[d].end;typeof p!=="undefined"&&p!==!1&&typeof t!=="undefined"&&t!==!1&&(r.append(a("<div>",{"class":"ganttview-vtheader-series-name"}).append("")),i.append(r));for(p=0;p<g[d].series.length;p++)r.append(a("<div>",{"class":"ganttview-vtheader-series-name"}).append(g[d].series[p].name));i.append(r);c.append(i)}q.append(c); g=a("<div>",{"class":"ganttview-slide-container",css:{width:b.slideWidth+"px"}});d=b.start;e=b.end;c=[];c[d.getFullYear()]=[];for(c[d.getFullYear()][d.getMonth()]=[d];d.compareTo(e)==-1;)d=d.clone().addDays(1),c[d.getFullYear()]||(c[d.getFullYear()]=[]),c[d.getFullYear()][d.getMonth()]||(c[d.getFullYear()][d.getMonth()]=[]),c[d.getFullYear()][d.getMonth()].push(d);var e=dates=c,c=b.cellWidth,d=a("<div>",{"class":"ganttview-hzheader"}),i=a("<div>",{"class":"ganttview-hzheader-months"}),r=a("<div>", {"class":"ganttview-hzheader-days"}),p=0,l;for(l in e)for(var m in e[l]){t=e[l][m].length*c;p+=t;i.append(a("<div>",{"class":"ganttview-hzheader-month",css:{width:t-1+"px"}}).append(f[m]+"/"+l));for(var j in e[l][m])r.append(a("<div>",{"class":"ganttview-hzheader-day"}).append(e[l][m][j].getDate()))}i.css("width",p+"px");r.css("width",p+"px");d.append(i).append(r);g.append(d);l=b.data;e=dates;c=b.cellWidth;d=b.showWeekends;m=a("<div>",{"class":"ganttview-grid"});j=a("<div>",{"class":"ganttview-grid-row"}); for(var h in e)for(var n in e[h])for(var o in e[h][n])i=a("<div>",{"class":"ganttview-grid-row-cell"}),s.isWeekend(e[h][n][o])&&d&&i.addClass("ganttview-weekend"),j.append(i);h=a("div.ganttview-grid-row-cell",j).length*c;j.css("width",h+"px");m.css("width",h+"px");for(h=0;h<l.length;h++){n=l[h].start;o=l[h].end;typeof n!=="undefined"&&n!==!1&&typeof o!=="undefined"&&o!==!1&&m.append(j.clone());for(n=0;n<l[h].series.length;n++)m.append(j.clone())}g.append(m);h=b.data;n=a("<div>",{"class":"ganttview-blocks"}); for(o=0;o<h.length;o++){l=h[o].start;m=h[o].end;typeof l!=="undefined"&&l!==!1&&typeof m!=="undefined"&&m!==!1&&n.append(a("<div>",{"class":"ganttview-block-container"}));for(l=0;l<h[o].series.length;l++)n.append(a("<div>",{"class":"ganttview-block-container"}))}g.append(n);h=b.data;n=b.cellWidth;o=b.start;l=a("div.ganttview-blocks div.ganttview-block-container",g);for(j=m=0;j<h.length;j++){c=h[j].start;e=h[j].end;typeof c!=="undefined"&&c!==!1&&typeof e!=="undefined"&&e!==!1&&(e=s.daysBetween(c, e)+1,i=s.daysBetween(o,c),i=a("<div>",{"class":"ganttview-block",title:h[j].label+", "+e+" days",css:{width:e*n-9+"px","margin-left":i*n+3+"px"}}),k(i,h[j],[""]),h[j].color&&i.css("background-color",h[j].color),i.append(a("<div>",{"class":"ganttview-block-text"}).text(e)),a(l[m]).append(i),m+=1);for(c=0;c<h[j].series.length;c++)d=h[j].series[c],e=s.daysBetween(d.start,d.end)+1,i=s.daysBetween(o,d.start),i=a("<div>",{"class":"ganttview-block",title:d.label+", "+e+" days",css:{width:e*n-9+"px","margin-left":i* n+3+"px"}}),k(i,h[j],d),h[j].series[c].color&&i.css("background-color",h[j].series[c].color),i.append(a("<div>",{"class":"ganttview-block-text"}).text(e)),a(l[m]).append(i),m+=1}q.append(g);g=q.parent();a("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",g).addClass("last");a("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",g).addClass("last");a("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",g).addClass("last")}}},w=function(q,b){function k(c, d){a("div.ganttview-block",c).live("click",function(){d&&d(a(this).data("block-data"))})}function f(c,d,b,f){a("div.ganttview-block",c).resizable({grid:d,handles:"e,w",stop:function(){var g=a(this);e(c,g,d,b);f&&f(g.data("block-data"))}})}function g(c,d,b,f){a("div.ganttview-block",c).draggable({axis:"x",grid:[d,d],stop:function(){var g=a(this);e(c,g,d,b);f&&f(g.data("block-data"))}})}function e(c,d,b,e){var c=a("div.ganttview-slide-container",c),f=c.scrollLeft(),c=d.offset().left-c.offset().left- 1+f,f=Math.round(c/b),e=e.clone().addDays(f);d.data("block-data").start=e;f=d.outerWidth();b=Math.round(f/b)-1;d.data("block-data").end=e.clone().addDays(b);a("div.ganttview-block-text",d).text(b+1);d.css("top","").css("left","").css("position","relative").css("margin-left",c+"px")}return{apply:function(){b.behavior.clickable&&k(q,b.behavior.onClick);b.behavior.resizable&&f(q,b.cellWidth,b.start,b.behavior.onResize);b.behavior.draggable&&g(q,b.cellWidth,b.start,b.behavior.onDrag)}}},s={daysBetween:function(a, b){if(!a||!b)return 0;a=Date.parse(a);b=Date.parse(b);if(a.getYear()==1901||b.getYear()==8099)return 0;for(var k=0,f=a.clone();f.compareTo(b)==-1;)k+=1,f.addDays(1);return k},isWeekend:function(a){return a.getDay()%6==0},getBoundaryDatesFromData:function(a,b){var k=new Date;maxEnd=new Date;for(var f=0;f<a.length;f++)for(var g=0;g<a[f].series.length;g++){var e=Date.parse(a[f].series[g].start),c=Date.parse(a[f].series[g].end);f==0&&g==0&&(k=e,maxEnd=c);k.compareTo(e)==1&&(k=e);maxEnd.compareTo(c)== -1&&(maxEnd=c)}s.daysBetween(k,maxEnd)<b&&(maxEnd=k.clone().addDays(b));return[k,maxEnd]}}})(jQuery);