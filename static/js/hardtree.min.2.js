/* src="jquery.tinymce.js" */
(function(e){function u(){function g(b){b==="remove"&&this.each(function(a,f){var d=i(f);d&&d.remove()});this.find("span.mceEditor,div.mceEditor").each(function(a,f){var d=tinyMCE.get(f.id.replace(/_parent$/,""));d&&d.remove()})}function o(b){var a;if(b!==s){g.call(this);this.each(function(f,d){var c;if(c=tinyMCE.get(d.id))c.setContent(b)})}else if(this.length>0)if(a=tinyMCE.get(this[0].id))return a.getContent()}function i(b){var a=null;b&&b.id&&p.tinymce&&(a=tinyMCE.get(b.id));return a}function h(b){return!!(b&& b.length&&p.tinymce&&b.is(":tinymce"))}var j={};e.each(["text","html","val"],function(b,a){var f=j[a]=e.fn[a],d=a==="text";e.fn[a]=function(c){if(!h(this))return f.apply(this,arguments);if(c!==s){o.call(this.filter(":tinymce"),c);f.apply(this.not(":tinymce"),arguments);return this}else{var k="",n=arguments;(d?this:this.eq(0)).each(function(l,m){var q=i(m);k+=q?d?q.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):q.getContent():f.apply(e(m),n)});return k}}});e.each(["append","prepend"],function(b, a){var f=j[a]=e.fn[a],d=a==="prepend";e.fn[a]=function(c){if(!h(this))return f.apply(this,arguments);if(c!==s){this.filter(":tinymce").each(function(k,n){var l=i(n);l&&l.setContent(d?c+l.getContent():l.getContent()+c)});f.apply(this.not(":tinymce"),arguments);return this}}});e.each(["remove","replaceWith","replaceAll","empty"],function(b,a){var f=j[a]=e.fn[a];e.fn[a]=function(){g.call(this,a);return f.apply(this,arguments)}});j.attr=e.fn.attr;e.fn.attr=function(b,a,f){if(!b||b!=="value"||!h(this))return j.attr.call(this, b,a,f);if(a!==s){o.call(this.filter(":tinymce"),a);j.attr.call(this.not(":tinymce"),b,a,f);return this}else{var d=this[0],c=i(d);return c?c.getContent():j.attr.call(e(d),b,a,f)}}}var s,t,v=[],p=window;e.fn.tinymce=function(g){function o(){var c=[],k=0;if(u){u();u=null}i.each(function(n,l){var m;m=l.id;var q=g.oninit;if(!m)l.id=m=tinymce.DOM.uniqueId();m=new tinymce.Editor(m,g);c.push(m);q&&m.onInit.add(function(){var w,r=q;if(++k==c.length){if(tinymce.is(r,"string")){w=r.indexOf(".")===-1?null:tinymce.resolve(r.replace(/\.\w+$/, ""));r=tinymce.resolve(r)}r.apply(w||tinymce,c)}})});e.each(c,function(n,l){l.render()})}var i=this,h,j,b,a,f="",d="";if(!i.length)return i;if(!g)return tinyMCE.get(i[0].id);if(!p.tinymce&&!t&&(h=g.script_url)){t=1;j=h.substring(0,h.lastIndexOf("/"));if(/_(src|dev)\.js/g.test(h))d="_src";b=h.lastIndexOf("?");if(b!=-1)f=h.substring(b+1);p.tinyMCEPreInit=p.tinyMCEPreInit||{base:j,suffix:d,query:f};if(h.indexOf("gzip")!=-1){a=g.language||"en";h=h+(/\?/.test(h)?"&":"?")+"js=true&core=true&suffix="+escape(d)+ "&themes="+escape(g.theme)+"&plugins="+escape(g.plugins)+"&languages="+a;p.tinyMCE_GZ||(tinyMCE_GZ={start:function(){function c(k){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(k))}tinymce.suffix=d;c("langs/"+a+".js");c("themes/"+g.theme+"/editor_template"+d+".js");c("themes/"+g.theme+"/langs/"+a+".js");e.each(g.plugins.split(","),function(k,n){if(n){c("plugins/"+n+"/editor_plugin"+d+".js");c("plugins/"+n+"/langs/"+a+".js")}})},end:function(){}})}e.ajax({type:"GET",url:h,dataType:"script", cache:true,success:function(){tinymce.dom.Event.domLoaded=1;t=2;g.script_loaded&&g.script_loaded();o();e.each(v,function(c,k){k()})}})}else t===1?v.push(o):o();return i};e.extend(e.expr[":"],{tinymce:function(g){return g.id&&!!tinyMCE.get(g.id)}})})(jQuery);

/* src="hashchange.js" */
(function(a,q,r){function f(d){d=d||location.href;return"#"+d.replace(/^[^#]*#?(.*)$/,"$1")}var b="hashchange",i=document,l,s=a.event.special,t=i.documentMode,m="on"+b in q&&(t===r||t>7);a.fn[b]=function(d){return d?this.bind(b,d):this.trigger(b)};a.fn[b].delay=50;s[b]=a.extend(s[b],{setup:function(){if(m)return false;a(l.start)},teardown:function(){if(m)return false;a(l.stop)}});l=function(){function d(){var c=f(),e=u(j);if(c!==j){n(j=c,e);a(q).trigger(b)}else if(e!==j)location.href=location.href.replace(/#.*/, "")+e;g=setTimeout(d,a.fn[b].delay)}var h={},g,j=f(),o=function(c){return c},n=o,u=o;h.start=function(){g||d()};h.stop=function(){g&&clearTimeout(g);g=r};a.browser.msie&&!m&&function(){var c,e;h.start=function(){if(!c){e=(e=a.fn[b].src)&&e+f();c=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){e||n(f());d()}).attr("src",e||"javascript:0").insertAfter("body")[0].contentWindow;i.onpropertychange=function(){try{if(event.propertyName==="title")c.document.title=i.title}catch(p){}}}}; h.stop=o;u=function(){return f(c.location.href)};n=function(p,w){var k=c.document,v=a.fn[b].domain;if(p!==w){k.title=i.title;k.open();v&&k.write('<script>document.domain="'+v+'"<\/script>');k.close();c.location.hash=p}}}();return h}()})(jQuery,this);

/* src="jquery.colorbox-min.js" */
(function(b,ib){var t="none",M="LoadedContent",c=false,v="resize.",o="y",q="auto",e=true,L="nofollow",m="x";function f(a,c){a=a?' id="'+i+a+'"':"";c=c?' style="'+c+'"':"";return b("<div"+a+c+"/>")}function p(a,b){b=b===m?n.width():n.height();return typeof a==="string"?Math.round(/%/.test(a)?b/100*parseInt(a,10):parseInt(a,10)):a}function U(b){return a.photo||/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i.test(b)}function cb(a){for(var c in a)if(b.isFunction(a[c])&&c.substring(0,2)!=="on")a[c]=a[c].call(l);a.rel=a.rel||l.rel||L;a.href=a.href||b(l).attr("href");a.title=a.title||l.title;return a}function w(c,a){a&&a.call(l);b.event.trigger(c)}function jb(){var b,e=i+"Slideshow_",c="click."+i,f,k;if(a.slideshow&&h[1]){f=function(){F.text(a.slideshowStop).unbind(c).bind(V,function(){if(g<h.length-1||a.loop)b=setTimeout(d.next,a.slideshowSpeed)}).bind(W,function(){clearTimeout(b)}).one(c+" "+N,k);j.removeClass(e+"off").addClass(e+"on");b=setTimeout(d.next,a.slideshowSpeed)};k=function(){clearTimeout(b);F.text(a.slideshowStart).unbind([V,W,N,c].join(" ")).one(c,f);j.removeClass(e+"on").addClass(e+"off")};a.slideshowAuto?f():k()}}function db(c){if(!O){l=c;a=cb(b.extend({},b.data(l,r)));h=b(l);g=0;if(a.rel!==L){h=b("."+G).filter(function(){return (b.data(this,r).rel||this.rel)===a.rel});g=h.index(l);if(g===-1){h=h.add(l);g=h.length-1}}if(!u){u=E=e;j.show();if(a.returnFocus)try{l.blur();b(l).one(eb,function(){try{this.focus()}catch(a){}})}catch(f){}x.css({opacity:+a.opacity,cursor:a.overlayClose?"pointer":q}).show();a.w=p(a.initialWidth,m);a.h=p(a.initialHeight,o);d.position(0);X&&n.bind(v+P+" scroll."+P,function(){x.css({width:n.width(),height:n.height(),top:n.scrollTop(),left:n.scrollLeft()})}).trigger("scroll."+P);w(fb,a.onOpen);Y.add(H).add(I).add(F).add(Z).hide();ab.html(a.close).show()}d.load(e)}}var gb={transition:"elastic",speed:300,width:c,initialWidth:"600",innerWidth:c,maxWidth:c,height:c,initialHeight:"450",innerHeight:c,maxHeight:c,scalePhotos:e,scrolling:e,inline:c,html:c,iframe:c,photo:c,href:c,title:c,rel:c,opacity:.9,preloading:e,current:"image {current} of {total}",previous:"previous",next:"next",close:"close",open:c,returnFocus:e,loop:e,slideshow:c,slideshowAuto:e,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:c,onLoad:c,onComplete:c,onCleanup:c,onClosed:c,overlayClose:e,escKey:e,arrowKey:e},r="colorbox",i="cbox",fb=i+"_open",W=i+"_load",V=i+"_complete",N=i+"_cleanup",eb=i+"_closed",Q=i+"_purge",hb=i+"_loaded",A=b.browser.msie&&!b.support.opacity,X=A&&b.browser.version<7,P=i+"_IE6",x,j,B,s,bb,T,R,S,h,n,k,J,K,Z,Y,F,I,H,ab,C,D,y,z,l,g,a,u,E,O=c,d,G=i+"Element";d=b.fn[r]=b[r]=function(c,f){var a=this,d;if(!a[0]&&a.selector)return a;c=c||{};if(f)c.onComplete=f;if(!a[0]||a.selector===undefined){a=b("<a/>");c.open=e}a.each(function(){b.data(this,r,b.extend({},b.data(this,r)||gb,c));b(this).addClass(G)});d=c.open;if(b.isFunction(d))d=d.call(a);d&&db(a[0]);return a};d.init=function(){var l="hover",m="clear:left";n=b(ib);j=f().attr({id:r,"class":A?i+"IE":""});x=f("Overlay",X?"position:absolute":"").hide();B=f("Wrapper");s=f("Content").append(k=f(M,"width:0; height:0; overflow:hidden"),K=f("LoadingOverlay").add(f("LoadingGraphic")),Z=f("Title"),Y=f("Current"),I=f("Next"),H=f("Previous"),F=f("Slideshow").bind(fb,jb),ab=f("Close"));B.append(f().append(f("TopLeft"),bb=f("TopCenter"),f("TopRight")),f(c,m).append(T=f("MiddleLeft"),s,R=f("MiddleRight")),f(c,m).append(f("BottomLeft"),S=f("BottomCenter"),f("BottomRight"))).children().children().css({"float":"left"});J=f(c,"position:absolute; width:9999px; visibility:hidden; display:none");b("body").prepend(x,j.append(B,J));s.children().hover(function(){b(this).addClass(l)},function(){b(this).removeClass(l)}).addClass(l);C=bb.height()+S.height()+s.outerHeight(e)-s.height();D=T.width()+R.width()+s.outerWidth(e)-s.width();y=k.outerHeight(e);z=k.outerWidth(e);j.css({"padding-bottom":C,"padding-right":D}).hide();I.click(d.next);H.click(d.prev);ab.click(d.close);s.children().removeClass(l);b("."+G).live("click",function(a){if(!(a.button!==0&&typeof a.button!=="undefined"||a.ctrlKey||a.shiftKey||a.altKey)){a.preventDefault();db(this)}});x.click(function(){a.overlayClose&&d.close()});b(document).bind("keydown",function(b){if(u&&a.escKey&&b.keyCode===27){b.preventDefault();d.close()}if(u&&a.arrowKey&&!E&&h[1])if(b.keyCode===37&&(g||a.loop)){b.preventDefault();H.click()}else if(b.keyCode===39&&(g<h.length-1||a.loop)){b.preventDefault();I.click()}})};d.remove=function(){j.add(x).remove();b("."+G).die("click").removeData(r).removeClass(G)};d.position=function(f,d){function b(a){bb[0].style.width=S[0].style.width=s[0].style.width=a.style.width;K[0].style.height=K[1].style.height=s[0].style.height=T[0].style.height=R[0].style.height=a.style.height}var e,h=Math.max(document.documentElement.clientHeight-a.h-y-C,0)/2+n.scrollTop(),g=Math.max(n.width()-a.w-z-D,0)/2+n.scrollLeft();e=j.width()===a.w+z&&j.height()===a.h+y?0:f;B[0].style.width=B[0].style.height="9999px";j.dequeue().animate({width:a.w+z,height:a.h+y,top:h,left:g},{duration:e,complete:function(){b(this);E=c;B[0].style.width=a.w+z+D+"px";B[0].style.height=a.h+y+C+"px";d&&d()},step:function(){b(this)}})};d.resize=function(b){if(u){b=b||{};if(b.width)a.w=p(b.width,m)-z-D;if(b.innerWidth)a.w=p(b.innerWidth,m);k.css({width:a.w});if(b.height)a.h=p(b.height,o)-y-C;if(b.innerHeight)a.h=p(b.innerHeight,o);if(!b.innerHeight&&!b.height){b=k.wrapInner("<div style='overflow:auto'></div>").children();a.h=b.height();b.replaceWith(b.children())}k.css({height:a.h});d.position(a.transition===t?0:a.speed)}};d.prep=function(o){var e="hidden";function m(t){var q,f,o,e,m=h.length,s=a.loop;d.position(t,function(){if(u){A&&p&&k.fadeIn(100);k.show();w(hb);Z.show().html(a.title);if(m>1){typeof a.current==="string"&&Y.html(a.current.replace(/\{current\}/,g+1).replace(/\{total\}/,m)).show();I[s||g<m-1?"show":"hide"]().html(a.next);H[s||g?"show":"hide"]().html(a.previous);q=g?h[g-1]:h[m-1];o=g<m-1?h[g+1]:h[0];a.slideshow&&F.show();if(a.preloading){e=b.data(o,r).href||o.href;f=b.data(q,r).href||q.href;e=b.isFunction(e)?e.call(o):e;f=b.isFunction(f)?f.call(q):f;if(U(e))b("<img/>")[0].src=e;if(U(f))b("<img/>")[0].src=f}}K.hide();if(a.transition==="fade")j.fadeTo(l,1,function(){if(A)j[0].style.filter=c});else if(A)j[0].style.filter=c;n.bind(v+i,function(){d.position(0)});w(V,a.onComplete)}})}if(u){var p,l=a.transition===t?0:a.speed;n.unbind(v+i);k.remove();k=f(M).html(o);k.hide().appendTo(J.show()).css({width:function(){a.w=a.w||k.width();a.w=a.mw&&a.mw<a.w?a.mw:a.w;return a.w}(),overflow:a.scrolling?q:e}).css({height:function(){a.h=a.h||k.height();a.h=a.mh&&a.mh<a.h?a.mh:a.h;return a.h}()}).prependTo(s);J.hide();b("#"+i+"Photo").css({cssFloat:t,marginLeft:q,marginRight:q});X&&b("select").not(j.find("select")).filter(function(){return this.style.visibility!==e}).css({visibility:e}).one(N,function(){this.style.visibility="inherit"});a.transition==="fade"?j.fadeTo(l,0,function(){m(0)}):m(l)}};d.load=function(u){var n,c,s,q=d.prep;E=e;l=h[g];u||(a=cb(b.extend({},b.data(l,r))));w(Q);w(W,a.onLoad);a.h=a.height?p(a.height,o)-y-C:a.innerHeight&&p(a.innerHeight,o);a.w=a.width?p(a.width,m)-z-D:a.innerWidth&&p(a.innerWidth,m);a.mw=a.w;a.mh=a.h;if(a.maxWidth){a.mw=p(a.maxWidth,m)-z-D;a.mw=a.w&&a.w<a.mw?a.w:a.mw}if(a.maxHeight){a.mh=p(a.maxHeight,o)-y-C;a.mh=a.h&&a.h<a.mh?a.h:a.mh}n=a.href;K.show();if(a.inline){f().hide().insertBefore(b(n)[0]).one(Q,function(){b(this).replaceWith(k.children())});q(b(n))}else if(a.iframe){j.one(hb,function(){var c=b("<iframe name='"+(new Date).getTime()+"' frameborder=0"+(a.scrolling?"":" scrolling='no'")+(A?" allowtransparency='true'":"")+" style='width:100%; height:100%; border:0; display:block;'/>");c[0].src=a.href;c.appendTo(k).one(Q,function(){c[0].src='//about:blank'})});q(" ")}else if(a.html)q(a.html);else if(U(n)){c=new Image;c.onload=function(){var e;c.onload=null;c.id=i+"Photo";b(c).css({border:t,display:"block",cssFloat:"left"});if(a.scalePhotos){s=function(){c.height-=c.height*e;c.width-=c.width*e};if(a.mw&&c.width>a.mw){e=(c.width-a.mw)/c.width;s()}if(a.mh&&c.height>a.mh){e=(c.height-a.mh)/c.height;s()}}if(a.h)c.style.marginTop=Math.max(a.h-c.height,0)/2+"px";h[1]&&(g<h.length-1||a.loop)&&b(c).css({cursor:"pointer"}).click(d.next);if(A)c.style.msInterpolationMode="bicubic";setTimeout(function(){q(c)},1)};setTimeout(function(){c.src=n},1)}else n&&J.load(n,function(d,c,a){q(c==="error"?"Request unsuccessful: "+a.statusText:b(this).children())})};d.next=function(){if(!E){g=g<h.length-1?g+1:0;d.load()}};d.prev=function(){if(!E){g=g?g-1:h.length-1;d.load()}};d.close=function(){if(u&&!O){O=e;u=c;w(N,a.onCleanup);n.unbind("."+i+" ."+P);x.fadeTo("fast",0);j.stop().fadeTo("fast",0,function(){w(Q);k.remove();j.add(x).css({opacity:1,cursor:q}).hide();setTimeout(function(){O=c;w(eb,a.onClosed)},1)})}};d.element=function(){return b(l)};d.settings=gb;b(d.init)})(jQuery,this)

/* src="treeio.js" */
var treeio={put_mce:function(a){(a?$("textarea",a):$("textarea")).each(function(){if(!$(this).hasClass("no-editor")){$(this).attr("id",a.attr("id")+"-"+$(this).attr("id"));$(this).hasClass("full-editor")?$(this).tinymce({script_url:"/static/js/tinymce/jscripts/tiny_mce/tiny_mce.js",theme:"advanced",plugins:"safari,table,advhr,inlinepopups,insertdatetime,preview,searchreplace,contextmenu,paste,fullscreen,nonbreaking,visualchars,xhtmlxtras",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,formatselect,fontselect,fontsizeselect,|,cut,copy,paste,pastetext,pasteword,|,search,replace", theme_advanced_buttons2:"bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,image,cleanup,code,|,insertdate,inserttime,preview,|,forecolor,backcolor,|,cite,abbr,acronym,del,ins",theme_advanced_buttons3:"tablecontrols,|,hr,removeformat,|,sub,sup,|,visualchars,nonbreaking,charmap,advhr,|,fullscreen",theme_advanced_disable:"help,styleselect,anchor,newdocument",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:true, theme_advanced_resize_horizontal:true,theme_advanced_resizing_use_cookie:true,theme_advanced_path:false,width:"80%"}):$(this).tinymce({script_url:"/static/js/tinymce/jscripts/tiny_mce/tiny_mce.js",theme:"advanced",plugins:"safari,table,advhr,inlinepopups,insertdatetime,preview,searchreplace,contextmenu,paste,fullscreen,nonbreaking,visualchars,xhtmlxtras",theme_advanced_statusbar_location:"bottom",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_path:false,theme_advanced_resizing:true, theme_advanced_resize_horizontal:true,theme_advanced_resizing_use_cookie:true,theme_advanced_disable:"justifyleft,justifycenter,justifyright,justifyfull,outdent,indent,image,help,hr,removeformat,formatselect,fontselect,fontsizeselect,styleselect,sub,sup,forecolor,backcolor,forecolorpicker,backcolorpicker,charmap,visualaid,anchor,newdocument,blockquote",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,undo,redo,|,cut,copy,paste,link,unlink,cleanup,|,bullist,numlist,|,code",theme_advanced_buttons2:"", theme_advanced_buttons3:"",width:"80%"})}})},remove_mce:function(a){(a?$("textarea",a):$("textarea")).each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},do_ajax:function(){var a=window.location.hash.replace(/#/gi,"");if(!a)a=window.location.pathname;var c=$('.menu-item a[href="#'+a+'"]');if(c.length)if(!c.hasClass("active")){block=$("#module-"+c.attr("id").substring(5));if(block.length){$(".module-block").each(function(){if($(this).attr("id")!=block.attr("id")){$(this).css("display", "none");$(this).data("active",false)}else{block.css("display","block");block.data("active",true)}});document.title=block.data("title");$(".menu-item a").each(function(){$(this).removeClass("active")});c.addClass("active");a=""}}if(a){a=treeio.prepare_url(a);$("#loading-status").css("display","block");$("#loading-status-text").html("Loading...");$.ajax({url:a,dataType:"json",success:treeio.process_ajax,complete:treeio.process_html,error:treeio.show_error})}},show_error:function(){$("#loading-status-text").html("Something went wrong...")}, process_userblock:function(a){a.response.messages&&$("#userblock-messages").each(function(){$(this).html(a.response.messages)});a.response.notifications&&$("#userblock-notifications").each(function(){$(this).html(a.response.notifications)})},process_ajax:function(a){if(a.redirect)if(window.location.hash=="#"+a.redirect)treeio.do_ajax();else window.location.hash=a.redirect;else if(a.redirect_out)window.location=a.redirect_out;else if(a.popup)treeio.process_popup_data(a);else{document.title=a.response.content.title; var c=a.response.content.module_content,b=a.response.modules.active,d="none";if($("#module-"+b).length==0)$("#content").append('<div class="module-block" id="module-'+b+'"></div>');else{var e=$("td.module-sidebar-right",$("#module-"+b));if(e)d=e.css("display")}var f=$("#module-"+b);$(".module-block").each(function(){if($(this).attr("id")!=f.attr("id")){$(this).css("display","none");$(this).data("active",false)}else{f.css("display","block");f.data("active",true)}});treeio.remove_mce($("#module-"+ b+" form"));$("#module-"+b).html(c);if($("#module-"+b+" form").length){treeio.prepare_forms($("#module-"+b));$("#module-"+b+" textarea").length&&treeio.put_mce($("#module-"+b))}treeio.prepare_list_actions($("#module-"+b));treeio.prepare_popups($("#module-"+b));treeio.convert_links($("#module-"+b));treeio.prepare_slider_sidebar($("#module-"+b),d);treeio.showhidejs($("#module-"+b));treeio.prepare_module_stuff(b);$(".menu-item a").each(function(){$(this).removeClass("active")});treeio.process_userblock(a); $("#menu-"+b).addClass("active");$("#module-"+b).data("title",a.response.content.title);$("#loading-status").css("display","none")}},process_html:function(a,c){c=="parsererror"&&window.document.write(a.responseText)},prepare_module_stuff:function(a){try{treeio.modules[a].init()}catch(c){}},prepare_url:function(a){if(a.indexOf("!")!=-1){a=a.replace("!","?");if(a.indexOf(".ajax")==-1)a=a.replace("?",".ajax?")}if(a.indexOf(".ajax")==-1)a+=".ajax?";return a},showhidejs:function(a){if(a){var c=$("div.showjs", a);a=$("div.hidejs",a)}else{c=$("div.showjs");a=$("div.hidejs")}c.each(function(){$(this).css("display","block")});a.each(function(){$(this).css("display","none")})},convert_links:function(a){(a?$("a",a):$("a")).each(function(){if($(this).attr("href")&&!$(this).hasClass("ajax-link-out")&&!$(this).attr("target")&&$(this).attr("href").substring(0,3)!="www"&&$(this).attr("href").substring(0,5)!="http:"&&$(this).attr("href").substring(0,6)!="https:"&&$(this).attr("href").substring(0,4)!="ftp:"&&$(this).attr("href").substring(0, 7)!="mailto:"){$(this).attr("href",("#"+$(this).attr("href")).replace("?","!"));if($.browser.msie&&$.browser.version.substr(0,1)<7){var c=window.location.href.replace(window.location.hash,"");$(this).attr("href",$(this).attr("href").replace(c,""))}}})},prepare_slider_sidebar:function(a,c){a||(a=$(".module-block"));var b=$("<div>&lt;</div>").addClass("sidebar-slider");$("td.module-content-inner",a).prepend(b);b.data("sidebar",$("td.module-sidebar-right",a));b.click(function(){var d=$(this).data("sidebar"); if(d)if(d.css("display")=="none"){d.fadeIn();$(this).html("&gt;")}else{d.fadeOut();$(this).html("&lt;")}});if(c){$("td.module-sidebar-right",a).css("display",c);c!="none"&&b.html("&gt;")}else $("td.module-sidebar-right",a).css("display","none")},prepare_list_actions:function(a){$(".content-list-item",a).each(function(){$("span.content-list-item-actions",$(this)).css("visibility","hidden");$(this).mouseover(function(){$("span.content-list-item-actions",$(this)).css("visibility","visible")}).mouseout(function(){$("span.content-list-item-actions", $(this)).css("visibility","hidden")});$("span.content-list-item-actions a",$(this)).addClass("popup-link")})},put_datepicker:function(a){$("input.datepicker",a).each(function(){var c={},b=$(this).attr("initial");if(b){b=parseInt(b)*1E3;c.defaultDate=new Date(b)}$(this).datepicker(c)});$("input.datetimepicker",a).each(function(){var c={stepMinute:5,hour:12,minute:0,firstDay:1},b=$(this).attr("initial");if(b){b=parseInt(b)*1E3;b=new Date(b);c.defaultDate=b;c.hour=b.getHours();c.minute=b.getMinutes(); c.second=b.getSeconds()}$(this).datetimepicker(c)})},prepare_mass_form:function(a){$("input[type=checkbox].group-control",a).click(function(){$("input[type=checkbox].group-"+$(this).attr("name")).attr("checked",$(this).attr("checked"))})},prepare_popup_content:function(a){var c=a.popup_id;if($("#"+c).length){var b=$("#"+c);$("a",b).each(function(){if($(this).attr("href")&&!$(this).hasClass("popup-link")&&!$(this).hasClass("ajax-link-out")&&!$(this).attr("target")&&$(this).attr("href").substring(0, 3)!="www"&&$(this).attr("href").substring(0,5)!="http:"&&$(this).attr("href").substring(0,6)!="https:"&&$(this).attr("href").substring(0,4)!="ftp:"&&$(this).attr("href").substring(0,7)!="mailto:"){$(this).data("href",c+"/url="+$(this).attr("href"));if($.browser.msie&&$.browser.version.substr(0,1)<7){var d=window.location.href.replace(window.location.hash,"");$(this).data("href",$(this).data("href").replace(d,"/"))}$(this).click(function(){$("#loading-status").css("display","block");url="/user/popup/"+ $(this).data("href");$.ajax({url:url,dataType:"json",success:treeio.process_popup_data});return false})}});treeio.prepare_popups(b);$("form",b).each(function(){url=(url=$(this).attr("action"))?"/user/popup/"+a.popup_id+"/url="+url:a.url;$(this).attr("action",url);var d={beforeSubmit:function(){$("#loading-status").css("display","block")},url:url,dataType:"json",success:treeio.process_ajax};$(this).ajaxForm(d)});treeio.prepare_autocomplete(b);treeio.prepare_search_duplicates(b);treeio.put_datepicker(b); treeio.prepare_mass_form(b);treeio.put_mce(b)}},process_popup_data:function(a){if(a.popup){var c=$("#"+a.popup.popup_id);if(a.popup.object){if(c.data("field")){var b=$("#"+c.data("module")),d=$("#"+c.data("field"),b);if(d.hasClass("autocomplete")){d.val(a.popup.object.name);b=$("#"+d.attr("id").replace("autocomplete_",""),b);b.each(function(){$(this).val(a.popup.object.id)})}else if(d.hasClass("duplicates")){d.val(a.popup.object.name);b=$("#"+d.attr("id").replace("duplicates_",""),b);b.each(function(){$(this).val(a.popup.object.id)})}else d.append('<option value="'+ a.popup.object.id+'" selected="selected">'+a.popup.object.name+"</option>")}else{b=location.hash.substring(1);b=treeio.prepare_url(b);$("#loading-status").css("display","block");$.ajax({url:b,dataType:"json",success:treeio.process_ajax,complete:treeio.process_html})}c.parent().remove()}else if(a.popup.redirect){b=location.hash.substring(1);b=treeio.prepare_url(b);$("#loading-status").css("display","block");$.ajax({url:b,dataType:"json",success:treeio.process_ajax,complete:treeio.process_html}); c.parent().remove()}else{b=c.parent().children("div.popup-title-block");b.children("span.popup-title").html(a.popup.title);b.children("span.popup-subtitle").html(a.popup.subtitle);c.html(a.popup.content);treeio.prepare_popup_content(a.popup);c.parent().css("display","block");$(window).width()<=c.parent().width()+c.parent().offset().left+30&&c.parent().css("right",30)}}$("#loading-status").css("display","none")},prepare_popups:function(a){$("a.popup-link",a).each(function(){$(this).click(function(){var c= a.attr("id")+"-popup-"+$(this).attr("id");if($("#"+c).length)return false;$("#loading-status").css("display","block");var b=$("<div></div>").addClass("popup-block").css("display","none").css("visibility","visible");b.data("link",$(this).attr("href"));var d=$("<div></div>").addClass("popup-title-block");d.append($("<span></span>").addClass("popup-title"));d.append($("<span></span>").addClass("popup-subtitle"));var e=$("<div></div>").addClass("popup-link-open");e.click(function(){var h=$(this).parent().data("link"); if(h){h=h.replace("#","");window.location.hash=h;$(this).parent().remove()}});var f=$("<div></div>").addClass("popup-close");f.click(function(){$("#"+c).length&&$("#"+c).parent().remove()});var g=$("<div></div>").addClass("popup-block-inner");g.attr("id",c);if($(this).attr("field")){g.data("field",$(this).attr("field"));g.data("module",a.attr("id"))}b.append(f);b.append(e);b.append(d);b.append(g);$(this).after(b);$(this).hasClass("help-block-link")&&b.css("right",30);b.draggable({handle:"div.popup-title-block", opacity:0.5,addClasses:false,start:function(h,i){i.helper.css("right",null)}});url="/user/popup/"+c+"/url="+$(this).attr("href").replace("#","");if($.browser.msie&&$.browser.version.substr(0,1)<7){url="/user/popup/"+c+"/url=/"+$(this).attr("href").replace("#","");b=window.location.href.replace(window.location.hash,"");url=url.replace(b,"")}$.ajax({url:url,dataType:"json",success:treeio.process_popup_data});return false})})},prepare_autocomplete:function(a){$("input.autocomplete",a).each(function(){$(this).data("hidden_field", $("#id_"+$(this).attr("name").replace("autocomplete_",""),a));$(this).autocomplete({source:$(this).attr("callback")+".json",focus:function(c,b){$(this).val(b.item.label);$(this).data("hidden_field").val(b.item.value);return false},select:function(c,b){$(this).val(b.item.label);$(this).data("hidden_field").val(b.item.value);return false}})});$("input.multicomplete",a).each(function(){$(this).data("hidden_fields",$("#"+$(this).attr("name").replace("multicomplete_","multi_"),a));$(this).bind("keydown", function(b){b.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active&&b.preventDefault()});$(this).bind("keyup",function(b){if(b.keyCode===$.ui.keyCode.BACKSPACE||b.keyCode===$.ui.keyCode.DELETE){b=treeio.utils.split(this.value);for(var d=$("input",$(this).data("hidden_fields")),e=0;e<d.length;e++){var f=$(d[e]).attr("label");$.inArray(f,b)==-1&&$(d[e]).remove()}}});var c=$(this).attr("callback")+".json";$(this).autocomplete({source:function(b,d){$.getJSON(c,{term:treeio.utils.extractLast(b.term)}, d)},search:function(){if(treeio.utils.extractLast(this.value).length<2)return false},focus:function(){return false},select:function(b,d){var e=treeio.utils.split(this.value);e.pop();e.push(d.item.label);e.push("");var f=$(this).data("hidden_fields"),g=$("<input>");g.attr("type","hidden").attr("name",$(this).attr("name").replace("multicomplete_","")).attr("id","id_"+g.attr("name")).attr("value",d.item.value).attr("label",d.item.label);this.value=e.join(", ");f.append(g);return false}})})},prepare_search_duplicates:function(a){$("input.duplicates", a).each(function(){$(this).data("hidden_field",$("#id_"+$(this).attr("name").replace("duplicates_",""),a));$(this).autocomplete({source:$(this).attr("callback")+".json",focus:function(c,b){$(this).val(b.item.label);return false},select:function(c,b){$(this).val(b.item.label);return false}})})},prepare_forms:function(a){$("form",a).each(function(){(url=$(this).attr("action"))||(url=location.hash.substring(1));url=treeio.prepare_url(url);var c={beforeSubmit:function(){$("#loading-status").css("display", "block")},url:url,dataType:"json",success:treeio.process_ajax};$(this).ajaxForm(c)});treeio.prepare_mass_form(a);treeio.prepare_autocomplete(a);treeio.prepare_search_duplicates(a);treeio.put_datepicker(a)}};treeio.utils={split:function(a){return a.split(/,\s*/)},extractLast:function(a){return treeio.utils.split(a).pop()}}; treeio.modules={"treeio-home":{init:function(){$("#widget-area").sortable({opacity:0.6,cursor:"move",update:function(){url=$("#widget-area").attr("callback")+"?"+$(this).sortable("serialize");$.ajax({url:url})}})}},"treeio-projects":{timer:function(){var a=$(".projects-timeslot");if(a){a.each(function(){var c=$(this).data("start"),b=Date.now();if(c==null){c=parseInt($(this).attr("diff"));c=b-c*1E3;$(this).data("start",c)}var d=(b-c)/1E3;c=Math.floor(d/3600);b=Math.floor((d/3600-c)*60);d=Math.round(((d/ 3600-c)*60-b)*60);c=c+":";c+=b>=10?b+":":"0"+b+":";c+=d>=10?d:"0"+d;$(this).html(c)});window.setTimeout(treeio.modules["treeio-projects"].timer,1E3)}},init:function(){$(".projects-timeslot")&&this.timer()}}}; treeio.nuvius={profile:null,access_popup:false,reload_on_profile:true,fetch_profile:function(){$("#loading-status").css("display","block");$("#loading-status-text").html("Loading...");$.ajax({url:nuvius_profile_url,dataType:"jsonp",success:treeio.nuvius.load_profile,error:treeio.show_error})},check_profile:function(a){if(a){if(a.key_valid){a.username?$("#nuvius-username").html(a.username):$("#nuvius-username").html("Anonymous User");treeio.nuvius.reload_on_profile&&treeio.do_ajax()}}else if(treeio.nuvius.profile){a= nuvius_profile_check_url;a+="?nuvius_id="+treeio.nuvius.profile.id+"&profile_key="+treeio.nuvius.profile.key;$.ajax({url:a,dataType:"json",success:treeio.nuvius.check_profile,error:treeio.show_error})}},load_profile:function(a){$("#loading-status").css("display","none");if(a.profile)if(!a.profile.access_granted&&treeio.nuvius.access_popup){$.colorbox({href:a.profile.access_url,width:"80%",height:"80%",iframe:true,overlayClose:false,onClosed:treeio.nuvius.fetch_profile});treeio.nuvius.access_popup= false}else{treeio.nuvius.profile=a.profile;treeio.nuvius.check_profile()}},fetch_access:function(){treeio.nuvius.access_popup=true;treeio.nuvius.fetch_profile()},close_iframe:function(){$.colorbox.close()}}; $(function(){$(window).hashchange(treeio.do_ajax);$(window).hashchange();treeio.convert_links();$(".menu-item a").each(function(){$(this).click(function(){$(this).hasClass("active")&&$(this).attr("href")==window.location.hash&&$(window).hashchange()})});$("#perspective_switch").each(function(){(url=$(this).attr("action"))||(url=location.hash.substring(1));url=treeio.prepare_url(url);var a={beforeSubmit:function(){$("#loading-status").css("display","block")},url:url,dataType:"json",success:treeio.process_ajax}; $(this).ajaxForm(a);$(this).children("select").change(function(){$("#perspective_switch").submit()})});$("form#search_form").each(function(){(url=$(this).attr("action"))||(url=location.hash.substring(1));url=treeio.prepare_url(url);var a={beforeSubmit:function(){$("#loading-status").css("display","block")},url:url,dataType:"json",success:treeio.process_ajax};$(this).ajaxForm(a)});$(".module-block").data("title",document.title);$(".module-block").each(function(){doc=$(this);if($("form").length){treeio.prepare_forms(doc); $("textarea").length&&treeio.put_mce(doc);treeio.put_datepicker(doc);treeio.prepare_forms(doc)}treeio.prepare_slider_sidebar(doc);treeio.prepare_list_actions(doc);treeio.prepare_popups(doc);treeio.showhidejs(doc);module_name=$(this).attr("id").substring(7);treeio.prepare_module_stuff(module_name)})});






