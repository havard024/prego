{% extends "json/services/page.json" %}
{% block module_content %}
    {
    "user": {{ user_block() }},
    "tickets":
      [
      {% for ticket in tickets %}
         {
         "id": {{ ticket.id }},
         "url": "{% url services_ticket_view ticket.id %}",
         "permissions": {{ permission_block(ticket) }},
         "name": "{{ ticket }}",
         {% if ticket.caller -%}
         "caller": {
                    "id": {{ ticket.caller_id }},
                    "url": "{% url identities_contact_view ticket.caller_id %}",
                    "name": "{{ ticket.caller }}"
                   },
         {% else -%}
         "caller": null,
         {% endif -%}
         "assigned": [
            {%- for assignee in ticket.assigned.all() %}
               {
                "id": {{ assignee.id }},
                "url": "{% url services_agent_view assignee.id %}",
                "name": "{{ assignee }}"
               {% if loop.last %}}{% else %}},{% endif %}
            {%- endfor -%}
         ],
         "status": {
                    "id": {{ ticket.status_id }},
                    "url": "{% url services_status_view ticket.status_id %}",
                    "name": "{{ ticket.status }}"
                   },
         {%- if ticket.queue %}
         "queue": {
                   "id": {{ ticket.queue_id }},
                   "url": "{% url services_queue_view ticket.queue_id %}",
                   "name": "{{ ticket.queue }}"
                  },
         {% else -%}
         "queue": null,
         {% endif -%}
         {% if ticket.service -%}
         "service": {
                     "id": {{ ticket.service_id }},
                     "url": "{% url services_service_view ticket.service_id %}",
                     "name": "{{ ticket.service }}"
                    },
         {% else -%}
         "service": null,
         {% endif -%}
         {% if ticket.sla -%}
         "sla": {
                 "id": {{ ticket.sla_id }},
                 "url": "{% url services_sla_view ticket.sla_id %}",
                 "name": "{{ ticket.sla }}"
                }
         {% else -%}
         "sla": null
         {% endif -%}
         {% if loop.last -%}
         }
         {% else -%}
         },
         {% endif -%}
         {% endfor %}
      ]
    }
{% endblock %}
